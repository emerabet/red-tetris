<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <main id='board'>
            <div class="row">
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
            </div>

            <div class="row">
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
            </div>

            <div class="row">
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
            </div>

            <div class="row">
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
            </div>

            <div class="row">
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
            </div>

            <div class="row">
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
            </div>

            <div class="row">
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
            </div>

            <div class="row">
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
            </div>

            <div class="row">
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
            </div>

            <div class="row">
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
            </div>

            <div class="row">
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
            </div>

            <div class="row">
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
            </div>

            <div class="row">
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
            </div>

            <div class="row">
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
            </div>

            <div class="row">
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
                <div class="row_cell">3/10</div>
            </div>

            <div class="row">
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
                <div class="row_cell">1/10</div>
            </div>

            <div class="row">
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
                <div class="row_cell">2/10</div>
            </div>

            <div class="row">
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
                <div class="row_cell locked"></div>
            </div>
            <button id='btnState' name='btnState'>Get State</button>
        </main>
        <script src="/socket.io/socket.io.js"></script>
        <script>

            const lookuptable = {
                1: 'shape-z',
                2: 'shape-s',
                3: 'shape-j',
                4: 'shape-l',
                5: 'shape-t',
                6: 'shape-i',
                7: 'shape-o',
            };

            const socket = io('http://localhost:4000', { 
                transports: ['websocket'],
                query: {
                    room: 'theroom',
                    pseudo: 'thepseudo'
                }
            });

            const board = document.querySelector('#board');
            const btnState = document.querySelector('#btnState');

            btnState.addEventListener('click', () => {
                console.log(socket.id);
                socket.emit('init');
            });


            function createCell(cell) {
                const state = cell === 0 ? 'empty' : (lookuptable[cell] || 'shape-z');
                return `<div class="row_cell ${state}">2/10</div>`;
            }

            function createRow(row) {
                let el = `<div class="row">`;
                row.forEach(cell => {
                    el += createCell(cell);
                });
                el += `</div>`;
                return el;
            }

            function drawGrid(grid) {
                let el = '';
                grid.forEach(row => {
                    el += createRow(row);
                });

                board.innerHTML = el;
            }
           
            socket.on('state', (grid) => {
                console.log(grid);
                drawGrid(grid);
            });

        </script>
    </body>
</html>